<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Secure ranking of a vector across all sources</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="../../assets/R.css" />
</head><body><div class="container">

<table width="100%" summary="page for ds.ranksSecure {dsBaseClient}"><tr><td>ds.ranksSecure {dsBaseClient}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Secure ranking of a vector across all sources</h2>

<h3>Description</h3>

<p>Securely generate the ranks of a numeric vector and estimate
true qlobal quantiles across all data sources simultaneously
</p>


<h3>Usage</h3>

<pre>
ds.ranksSecure(
  input.var.name = NULL,
  quantiles.for.estimation = "0.05-0.95",
  generate.quantiles = TRUE,
  output.ranks.df = NULL,
  summary.output.ranks.df = NULL,
  ranks.sort.by = "ID.orig",
  shared.seed.value = 10,
  synth.real.ratio = 2,
  NA.manage = "NA.delete",
  rm.residual.objects = TRUE,
  monitor.progress = FALSE,
  datasources = NULL
)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>input.var.name</code></td>
<td>
<p>a character string in a format that can pass through
the DataSHIELD R parser which specifies the name of the vector to be ranked.
Needs to have same name in each data source.</p>
</td></tr>
<tr valign="top"><td><code>quantiles.for.estimation</code></td>
<td>
<p>one of a restricted set of character strings.
To mitigate disclosure risk only the following set of quantiles can be
generated: c(0.025,0.05,0.10,0.20,0.25,0.30,0.3333,0.40,0.50,0.60,0.6667,
0.70,0.75,0.80,0.90,0.95,0.975). The allowable formats for the argument
are of the general form: &quot;0.025-0.975&quot; where the first number is the lowest
quantile to be estimated and the second number is the equivalent highest 
quantile to estimate. These two quantiles are then estimated along with
all allowable quantiles in between. The allowable argument values are then:
&quot;0.025-0.975&quot;, &quot;0.05-0.95&quot;, &quot;0.10-0.90&quot;, &quot;0.20-0.80&quot;. Two alternative values
are &quot;quartiles&quot; i.e. c(0.25,0.50,0.75), and &quot;median&quot; i.e. c(0.50). The
default value is &quot;0.05-0.95&quot;. If the sample size is so small that an extreme
quartile could be disclosive the function will be terminated and an error 
message returned telling you that you might try using an argument with a
narrower set of quantiles. This disclosure trap will be triggered if the
total number of subjects across all studies divided by the total number
of quantile values being estimated is less than or equal to nfilter.tab
(the minimum cell size in a contingency table).</p>
</td></tr>
<tr valign="top"><td><code>generate.quantiles</code></td>
<td>
<p>a logical value indicating whether the
ds.ranksSecure function should carry on to estimate the key quantile
values specified by argument &lt;quantiles.for.estimation&gt; or should stop
once the global ranks have been created and written to the serverside.
Default is TRUE and as the key quantiles are generally non-disclosive this
is usually the setting to use. But, if there is some abnormal configuration
of the clusters of values that are being ranked such that some values are
treated as being missing and the processing stops, then setting
generate.quantiles to FALSE allows the generation of ranks to complete so
they can then be used for non-parameteric analysis, even if the key values
cannot be estimated. A real example of an unusual configuration was in a
reasonably large dataset of survival times, where a substantial proportion
of survival profiles were censored at precisely 10 years. This meant that
the 97.5
the former was allocated the value NA. This stopped processing of the ranks
which could then be enabled by setting generate.quantiles to FALSE. However,
if this problem is detected an error message is returned which indicates that
in some cases (as in this case in fact) the problem can be circumvented
by selecting a narrow range of key quantiles to estimate. In this case, in
fact, this simply required changing the &lt;quantiles.for.estimation&gt; argument
from &quot;0.025-0.975&quot; to &quot;0.05-0.95&quot;.</p>
</td></tr>
<tr valign="top"><td><code>output.ranks.df</code></td>
<td>
<p>a character string in a format that can pass through
the DataSHIELD R parser which specifies an optional name for the
data.frame written to the serverside on each data source that contains
11 of the key output variables from the ranking procedure pertaining to that
particular data source. This includes the global ranks and quantiles of each
value of the V2BR (i.e. the values are ranked across all studies
simultaneously). If no name is specified, the default name
is allocated as &quot;full.ranks.df&quot;. This data.frame contains disclosive
information and cannot therefore be passed to the clientside.</p>
</td></tr>
<tr valign="top"><td><code>summary.output.ranks.df</code></td>
<td>
<p>a character string in a format that can pass through
the DataSHIELD R parser which specifies an optional name for the summary
data.frame written to the serverside on each data source that contains
5 of the key output variables from the ranking procedure pertaining to that
particular data source. This again includes the global ranks and quantiles of each
value of the V2BR (i.e. the values are ranked across all studies
simultaneously). If no name is specified, the default name
is allocated as &quot;summary.ranks.df&quot; This data.frame contains disclosive
information and cannot therefore be passed to the clientside.</p>
</td></tr>
<tr valign="top"><td><code>ranks.sort.by</code></td>
<td>
<p>a character string taking two possible values. These
are &quot;ID.orig&quot; and &quot;vals.orig&quot;. These define the order in which the
output.ranks.df and summary.output.ranks.df data frames are presented. If
the argument is set as &quot;ID.orig&quot; the order of rows in the output data frames
are precisely the same as the order of original input vector that is being
ranked (i.e. V2BR). This means the ranks can simply be cbinded to the
matrix, data frame or tibble that originally included V2BR so it also 
includes the corresponding ranks. If it is set as &quot;vals.orig&quot; the output
data frames are in order of increasing magnitude of the original values of
V2BR. Default value is &quot;ID.orig&quot;.</p>
</td></tr>
<tr valign="top"><td><code>shared.seed.value</code></td>
<td>
<p>an integer value which is used to set the
random seed generator in each study. Initially, the seed is set to be the
same in all studies, so the order and parameters of the repeated
encryption procedures are precisely the same in each study. Then a 
study-specific modification of the seed in each study ensures that the
procedures initially generating the masking pseudodata (which are then
subject to the same encryption procedures as the real data) are different
in each study. For further information about the shared seed and how we
intend to transmit it in the future, please see the detailed associated
header document.</p>
</td></tr>
<tr valign="top"><td><code>synth.real.ratio</code></td>
<td>
<p>an integer value specifying the ratio between the
number of masking pseudodata values generated in each study compared to
the number of real data values in V2BR.</p>
</td></tr>
<tr valign="top"><td><code>NA.manage</code></td>
<td>
<p>character string taking three possible values: &quot;NA.delete&quot;,
&quot;NA.low&quot;,&quot;NA.hi&quot;. This argument determines how missing values are managed
before ranking. &quot;NA.delete&quot; results in all missing values being removed
prior to ranking. This means that the vector of ranks in each study is 
shorter than the original vector of V2BR values by an amount corresponding
to the number of missing values in V2BR in that study. Any rows containing
missing values in V2BR are simply removed before the ranking procedure is
initiated so the order of rows without missing data is unaltered. &quot;NA.low&quot;
indicates that all missing values should be converted to a new value that
has a meaningful magnitude that is lower (more negative or less positive)
than the lowest non-missing value of V2BR in any of the studies. This means,
for example, that if there are a total of M values of V2BR that are missing
across all studies, there will be a total of M observations that are ranked
lowest each with a rank of (M+1)/2. So if 7 are missing the lowest 7 ranks
will be 4,4,4,4,4,4,4 and if 4 are missing the first 4 ranks will be 
2.5,2.5,2.5,2.5. &quot;NA.hi&quot; indicates that all missing values should be
converted to a new value that has a meaningful magnitude that is higher(less
negative or more positive)than the highest non-missing value of V2BR in any
of the studies. This means, for example, that if there are a total of M
values of V2BR that are missing across all studies and N non-missing
values, there will be a total of M observations that are ranked
highest each with a rank of (2N-M+1)/2. So if there are a total of 1000
V2BR values and 9 are missing the highest 9 ranks will be 996, 996 ... 996.
If NA.manage is either &quot;NA.low&quot; or &quot;NA.hi&quot; the final rank vector in each
study  will have the same length as the V2BR vector in that same study.
2.5,2.5,2.5,2.5. The default value of the &quot;NA.manage&quot; argument is &quot;NA.delete&quot;</p>
</td></tr>
<tr valign="top"><td><code>rm.residual.objects</code></td>
<td>
<p>logical value. Default = TRUE: at the beginning
and end of each run of ds.ranksSecure delete all extraneous objects that are
otherwise left behind. These are not usually needed, but could be of value
if one were investigating a problem with the ranking. FALSE: do not delete
the residual objects</p>
</td></tr>
<tr valign="top"><td><code>monitor.progress</code></td>
<td>
<p>logical value. Default = FALSE. If TRUE, function
outputs information about its progress.</p>
</td></tr>
<tr valign="top"><td><code>datasources</code></td>
<td>
<p>specifies the particular opal object(s) to use. If the
&lt;datasources&gt; argument is not specified (NULL) the default set of opals
will be used. If &lt;datasources&gt; is specified, it should be set without
inverted commas: e.g. datasources=opals.em. If you wish to
apply the function solely to e.g. the second opal server in a set of three,
the argument can be specified as: e.g. datasources=opals.em[2].
If you wish to specify the first and third opal servers in a set you specify:
e.g. datasources=opals.em[c(1,3)].</p>
</td></tr>
</table>


<h3>Details</h3>

<p>ds.ranksSecure is a clientside function which calls a series of
other clientside and serverside functions to securely generate the global
ranks of a numeric vector &quot;V2BR&quot; (vector to be ranked)
in order to set up analyses on V2BR based on
non-parametric methods, some types of survival analysis and to derive true
global quantiles (such as the median, lower (25
and the 95
global quantiles are, in general, different to the mean or median of the
equivalent quantiles calculated independently in each data source separately.
For more details about the cluster of functions that collectively
enable secure global ranking and estimation of global quantiles see the 
associated document entitled &quot;secure.global.ranking.docx&quot;.
</p>


<h3>Value</h3>

<p>the data frame objects specified by the arguments output.ranks.df
and summary.output.ranks.df. These are written to the serverside in each
study. Provided the sort order is consistent these data frames can be cbinded
to any other data frame, matrix or tibble object containing V2BR or to the
V2BR vector itself, allowing the global ranks and quantiles to be
analysed rather than the actual values of V2BR. The last call within
the ds.ranksSecure function is to another clientside function
ds.extractQuantile (for further details see header for that function).
This returns an additional data frame &quot;final.quantile.df&quot; of which the first
column is the vector of key quantiles to be estimated as specified by the
argument &lt;quantiles.for.estimation&gt; and the second column is the list of
precise values of V2BR which correspond to these key quantiles. Because
the serverside functions associated with ds.ranksSecure and
ds.extractQuantile block potentially disclosive output (see information
for parameter quantiles.for.estimation) the &quot;final.quantile.df&quot; is returned
to the client allowing the direct reporting of V2BR values corresponding to
key quantiles such as the quartiles, the median and 95th percentile etc. In
addition a copy of the same data frame is also written to the serverside in
each study allowing the value of key quantiles such as the median to be
incorporated directly in calculations or transformations on the serverside
regardless in which study (or studies) those key quantile values have
occurred.
</p>


<h3>Author(s)</h3>

<p>Paul Burton 4th November, 2021
</p>

<hr /><div style="text-align: center;">[Package <em>dsBaseClient</em> version 6.2.0 ]</div>
</div></body></html>
